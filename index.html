<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto LoRa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body { padding-top: 56px; /* Ajuste para la navbar fija */ }
        .section-content { display: none; }
        .section-content.active { display: block; }
        
        /* Pequeña transición para los badges y botones */
        .badge, .btn {
            transition: all 0.2s ease-in-out;
        }
        /* Estilo para que los botones en la tabla no ocupen tanto espacio vertical */
        #nodeTable .btn-sm {
            padding: 0.2rem 0.4rem;
            font-size: 0.8rem;
        }
        #nodeTable .bi { /* Ajuste vertical de iconos en botones */
            vertical-align: -0.1em;
            margin-right: 3px;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center gap-2" href="#" data-section="home">
                <img src="https://frt.utn.edu.ar/wp-content/uploads/elementor/thumbs/descarga-removebg-preview-qxah6c0ycvhe6sie8wx30a0gb3rf1yn226favl26tc-qy17u6no60q8xbkeh0dtetqyiz7hei7hiu2sc1k9vk.png" alt="UTN Logo" style="height:36px; width:auto; box-shadow:0 1px 4px rgba(0,0,0,0.07);">
                <span>Proyecto LoRa</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="home">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="dashboard-hist">Dashboard Histórico</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="dashboard-rt">Dashboard Tiempo Real</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="admin-nodos">Administración de Nodos</a>
                    </li>
                </ul>
                <div class="d-flex">
                    <button class="btn btn-outline-light btn-sm" onclick="cerrarSesion()">
                        <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
                    </button>
                </div>
                </div>
        </div>
    </nav>

    <div class="container-fluid mt-4" id="mainContentArea">
        </div>

    <div id="section-templates" style="display: none;">
        <div id="home-content">
            <h2>Bienvenido al Proyecto LoRa</h2>
            <p>Esta es la página de inicio con información general sobre el proyecto. Aquí puedes describir los objetivos, la tecnología utilizada (LoRaWAN, sensores, etc.), y el propósito de la aplicación.</p>
            <p>Este sistema permite la monitorización y gestión de nodos LoRa que reportan datos ambientales como temperatura, humedad y velocidad del viento.</p>
        </div>

                <div id="dashboard-hist-content">
                    <h2>Dashboard Histórico</h2>
                    <p>A continuación se muestra el dashboard de Power BI con los datos históricos recolectados por los nodos.</p>
                        <div style="position:relative; width:100%; padding-top:62.25%;">
                            <iframe title="Dashboard_web_proyectoFinal"
                                src="https://app.powerbi.com/view?r=eyJrIjoiMzYwMjJhMDItYjY5OS00YTM1LWE1MDgtZTE0YTcwOGU3NmQxIiwidCI6ImEzNGUyZWVmLTE0ZjUtNDAwMC04ZTQwLTc5MTc0M2I2MzcxMSIsImMiOjR9"
                                style="position:absolute; top:0; left:0; width:100%; height:100%; border:0;"
                                frameborder="0" allowfullscreen="true">
                            </iframe>
                        </div>
                </div>

        <div id="dashboard-rt-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Dashboard en Tiempo Real - PRUEBA DE ACTUALIZACIÓN</h2>
                <button class="btn btn-primary btn-sm" onclick="actualizarDashboardRT()">
                    <i class="bi bi-arrow-clockwise"></i> Actualizar
                </button>
            </div>
            <p>Datos más recientes reportados por los nodos LoRa en tiempo real.</p>
            
            <div id="dashboardLoading" class="text-center py-5" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mt-2">Cargando datos de los nodos...</p>
            </div>
            
            <div id="dashboardError" class="alert alert-danger" role="alert" style="display: none;">
                <i class="bi bi-exclamation-triangle"></i> 
                <strong>Error:</strong> <span id="errorMessage"></span>
            </div>
            
            <!-- Contenedor con navegación lateral -->
            <div class="dashboard-scroll-wrapper">
                <button id="btnScrollLeft" class="dashboard-nav-btn" onclick="scrollDashboard('left')">
                    <i class="bi bi-chevron-left"></i>
                </button>
                
                <div id="nodesContainer">
                    <!-- Las tarjetas de nodos se generarán dinámicamente aquí -->
                </div>
                
                <button id="btnScrollRight" class="dashboard-nav-btn" onclick="scrollDashboard('right')">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
            
            <div class="dashboard-nav-controls">
                <button id="scrollLeft" class="nav-btn" onclick="scrollDashboard('left')">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button id="scrollRight" class="nav-btn" onclick="scrollDashboard('right')">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
            
            <div class="scroll-indicator">
                <small><i class="bi bi-mouse"></i> Desliza horizontalmente para ver más estaciones</small>
            </div>
        </div>

        <div id="admin-nodos-content">
            <h1 class="mb-4">Administración de Nodos LoRa</h1>
            
            <div id="nodeFormContainer" class="mb-4 p-4 border rounded bg-light shadow-sm">
                <h2>Agregar Nuevo Nodo</h2>
                <form id="addNodeForm">
                    <div class="mb-3">
                        <label for="model" class="form-label">Modelo del Nodo:</label>
                        <input type="text" class="form-control" id="model" name="model" required>
                    </div>
                    <div class="mb-3">
                        <label for="refresh_rate" class="form-label">Refresh Rate (segundos):</label>
                        <input type="number" class="form-control" id="refresh_rate" name="refresh_rate" value="5" min="0" required>
                    </div>
                    <button type="button" id="agregarBtn" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
                            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3z"/>
                        </svg>
                        Agregar Nodo
                    </button>
                </form>
            </div>

            <h2 class="mt-5">Lista de Nodos</h2>
            <div class="table-responsive">
                <table id="nodeTable" class="table table-striped table-hover table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Modelo</th>
                            <th>Refresh Rate</th>
                            <th>Estado</th>
                            <th>Activado En</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="nodeList">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script src="js/api.js"></script>
        <script src="js/main.js"></script>

        <footer>
            Proyecto LoRa &copy; 2025 &mdash; Desarrollado por UTN Mesh
        </footer>
</body>
</html>